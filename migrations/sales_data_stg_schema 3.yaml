version: "1.2"

metadata:
  name: "sales_data_ingestion"
  owner: "data-eng-team"
  description: "Load sales CSV data from S3 into Snowflake"
  

datasets:
  - name: "sales_data_ingestion"
    source:
      type: "s3"
      file_pattern: ".*\\.csv"  # Specific file pattern
      bucket: "datalake-dev-dtrai-rawlayer-in-com-sy"

    target:
      type: "snowflake"
      database: "DRAI_INGESTION_DATABASE"
      schema: "DRAI_ING_SCHEMA"
      table: "SALES_DATA"

      stage:
        name: "DRAI_S3_EXTERNAL_STAGE_INBOUND"
        path: "sales_data/"
        file_format: "DRAI_CSV_FORMAT"
        validate: true

      schema_definition:
        sale_id: NUMBER
        product_id: NUMBER
        quantity: NUMBER
        sale_amount: FLOAT
        sale_date: DATE
        

    ingestion:
      method: "copy_into"
      copy_options:
        load_strategy: "DROP_AND_CREATE"  #TRUNCATE_AND_LOAD, DROP_AND_CREATE
        validation_mode: false
        purge: false
        force: false
        multi_file: true
        on_error: "CONTINUE"
 
audit:
  enabled: true
  table: "INGESTION_AUDIT_LOG"
  schema: "DRAI_ING_SCHEMA"
